## 1. How to enable Spring Security in a Spring Boot Application?

- Add Spring Security dependency to your project

```xml

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

- By default, Spring Security secures all endpoints with basic authentication
- Spring Security 6.x requires Java 17+
- Create a configuration class to customize security settings
- Below is example of CSRF(enabled by default), health disable, other URLs enabled, using filter chain, etc.

```java

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtFilter;

    public SecurityConfig(JwtAuthenticationFilter jwtFilter) {
        this.jwtFilter = jwtFilter;
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .csrf().disable() // For stateless APIs
                .authorizeHttpRequests(authorize -> authorize
                        .requestMatchers("/health").permitAll() // public endpoint
                        .requestMatchers("/admin/**").hasRole("ADMIN") // ADMIN role
                        .requestMatchers("/user/**").hasAnyRole("USER", "ADMIN") // USER or ADMIN
                        .anyRequest().authenticated()
                )
                // Add custom JWT filter before authentication filter
                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}

```

```java

@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain) throws ServletException, IOException {

        String authHeader = request.getHeader("Authorization");

        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            String token = authHeader.substring(7);

            try {
                String username = JwtUtil.getUsername(token);
                List<String> roles = JwtUtil.getRoles(token);

                // Convert roles to SimpleGrantedAuthority
                List<SimpleGrantedAuthority> authorities = roles.stream().map(role -> new SimpleGrantedAuthority("ROLE_" + role)).collect(Collectors.toList());

                // Create authentication object
                UsernamePasswordAuthenticationToken auth = new UsernamePasswordAuthenticationToken(username, null, authorities);

                SecurityContextHolder.getContext().setAuthentication(auth);
            } catch (Exception e) {
                response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
                return;
            }
        }
        filterChain.doFilter(request, response);
    }
}
```

---

## 2. How to implement CORS in Spring Boot?

- CORS (Cross-Origin Resource Sharing) allows controlled access to resources from different origins
- Enable CORS globally using `WebMvcConfigurer`

```java

@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**") // Apply to all endpoints
                .allowedOrigins("http://allowed-origin.com") // Specify allowed origins
                .allowedMethods("GET", "POST", "PUT", "DELETE") // Allowed HTTP methods
                .allowedHeaders("*") // Allow all headers
                .allowCredentials(true) // Allow credentials
                .maxAge(3600); // Cache preflight response for 1 hour
    }
}
```

---

## 3. What is CSRF and how to prevent it in Spring Boot?

- CSRF (Cross-Site Request Forgery) is an attack that tricks authenticated users into submitting requests to a web
  application without their consent
- Spring Security enables CSRF protection by default
- To prevent CSRF attacks:
    - Use CSRF tokens in forms and AJAX requests
    - In Spring Security, CSRF tokens are automatically included in forms generated by Thymeleaf
- For stateless APIs (e.g., RESTful services), you may disable CSRF protection

```java
http.csrf().

disable(); // Disable CSRF for stateless APIs
```

---

## 4. Does stateless apis doesn't need CSRF protection?

- Yes, stateless APIs typically do not require CSRF protection
- CSRF attacks rely on the presence of cookies for authentication
- Stateless APIs often use tokens (e.g., JWT) in headers for authentication, which are not automatically sent by
  browsers
- Therefore, CSRF protection is less relevant for stateless APIs

---

## 5. Why we need Spring security over simple authentication and authorization?

- Comprehensive security features (authentication, authorization, CSRF protection, etc.)
- Integration with various authentication mechanisms (LDAP, OAuth2, JWT, etc.)
- Customizable security policies, Active community and regular updates. Seamless integration with Spring ecosystem

---

## 6. Why to go for OAuth2 over smile JWT token based authentication?

- OAuth2 provides delegated access, allowing third-party applications to access resources without sharing credentials
- Supports various grant types (authorization code, client credentials, etc.) for different use cases
- Standardized protocol with wide adoption and support
- Better suited for complex scenarios involving multiple clients and resource servers

---

## 7. Component of JWT/OAuth2 Token?

- Header: Contains metadata about the token (type, signing algorithm)
- Payload: Contains claims (user info, expiration, issuer, etc.)
- Signature: Ensures token integrity and authenticity

### Can we tamper JWT token?

- Yes, JWT tokens can be tampered with if not properly signed
- Use strong signing algorithms (e.g., HS256, RS256) to prevent tampering
- Always validate the token signature on the server side

---

## 8. Difference between Authentication and Authorization?

| Aspect         | Authentication         | Authorization          |
|----------------|------------------------|------------------------|
| **Definition** | Verifying identity     | Granting access rights |
| **Purpose**    | Who you are            | What you can do        |
| **Process**    | Login with credentials | Check permissions      |

---

## 9. How will you secure your code in Spring Boot Application 

### in terms of sensitive data?
- Use Spring Cloud Config with encryption for sensitive properties
- Use environment variables or external configuration files
- Avoid hardcoding sensitive data in the codebase
- Use Jasypt for encrypting properties in `application.properties` or `application.yml`

### in terms of Vulnerabilities?
- Keep dependencies up to date
- Use static code analysis tools (e.g., SonarQube, Checkmarx)
- Implement input validation and sanitization
- Use HTTPS for secure communication

### in terms of Security Bugs?
- Run ADSF scans. ADSF: Application Development Security Framework
- Conduct regular security audits and code reviews

---
